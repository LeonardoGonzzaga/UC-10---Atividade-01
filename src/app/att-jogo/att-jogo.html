<section class="gerenciar-container">
    <h2>üõ†Ô∏è Gerenciamento de Jogos</h2>

    <div class="header-gerenciamento">
        <div class="botoes-header">
            <button class="btn btn-principal" routerLink="/cadastroJogos">
                ‚ûï Ir para Cadastro de Jogos
            </button>
            <button class="btn btn-logout" (click)="logout()">
                üö™ Logout
            </button>
        </div>
    </div>
    <div *ngIf="mensagem" class="alerta sucesso">{{ mensagem }}</div>

    <div *ngIf="isLoading" class="alerta loading">Carregando lista de jogos...</div>

    <div *ngIf="estaEditando" class="edicao-wrapper">
        <h3 class="titulo-edicao">Editar Jogo ID: {{ jogoParaEditar.id }}</h3>

        <form (ngSubmit)="salvarAtualizacao()">

            <div class="form-group">
                <label for="editNome">Nome do Jogo:</label>
                <input 
                    id="editNome" 
                    name="editNome"
                    type="text" 
                    class="form-control"
                    [(ngModel)]="jogoParaEditar.nome" 
                    required>
            </div>

            <div class="form-group">
                <label for="editDescricao">Descri√ß√£o:</label>
                <textarea 
                    id="editDescricao" 
                    name="editDescricao"
                    class="form-control"
                    rows="4"
                    [(ngModel)]="jogoParaEditar.descricao" 
                    required></textarea>
            </div>

            <div class="form-group">
                <label for="editSobre">Sobre este Jogo (informa√ß√µes detalhadas):</label>

                <div class="rte-toolbar">
                    <button type="button" class="rte-btn" (click)="applyFormat('bold')">B</button>
                    <button type="button" class="rte-btn" (click)="applyFormat('italic')"><i>i</i></button>
                    <button type="button" class="rte-btn" (click)="applyFormat('underline')">U</button>
                    <button type="button" class="rte-btn" (click)="applyFormat('insertUnorderedList')">‚Ä¢ Lista</button>
                    <button type="button" class="rte-btn" (click)="applyFormat('insertOrderedList')">1. Lista</button>
                    <button type="button" class="rte-btn" (click)="applyFormat('formatBlock','<h2>')">H2</button>
                    <input type="color" title="Cor do texto" (change)="applyFormat('foreColor', $event.target.value)" />
                    <button type="button" class="rte-btn" (click)="createLink()">Link</button>
                </div>

                <div #editor id="editSobre" class="rte-editor form-control" contenteditable="true" aria-label="Editor de texto para 'Sobre este Jogo'"></div>
            </div>

            <div class="form-group">
                <label for="editPreco">Pre√ßo (R$):</label>
                <input 
                    id="editPreco" 
                    name="editPreco"
                    type="number" 
                    class="form-control"
                    step="0.01" 
                    min="0"
                    [(ngModel)]="jogoParaEditar.preco" 
                    required>
            </div>

            <div class="form-group">
                <label for="editImagemUrl">URL da Imagem:</label>
                <input 
                    id="editImagemUrl" 
                    name="editImagemUrl"
                    type="text" 
                    class="form-control"
                    [(ngModel)]="jogoParaEditar.imagemUrl" 
                    required>
            </div>
            
            <div class="image-preview-container" *ngIf="jogoParaEditar.imagemUrl">
                 <img [src]="jogoParaEditar.imagemUrl" alt="Pr√©via da Imagem" class="image-preview-edicao">
            </div>
            <div class="detalhes-adicionais">
                <h4>Detalhes Adicionais</h4>

                <div class="form-group">
                    <label for="editGenero">G√™nero:</label>
                    <input id="editGenero" name="editGenero" type="text" class="form-control" [(ngModel)]="jogoParaEditar.genero">
                </div>

                <div class="form-group">
                    <label for="editPublisher">Publisher:</label>
                    <input id="editPublisher" name="editPublisher" type="text" class="form-control" [(ngModel)]="jogoParaEditar.publisher">
                </div>

                <div class="form-group">
                    <label for="editDesenvolvedora">Desenvolvedora:</label>
                    <input id="editDesenvolvedora" name="editDesenvolvedora" type="text" class="form-control" [(ngModel)]="jogoParaEditar.desenvolvedora">
                </div>

                <div class="form-group">
                    <label for="editDataLancamento">Data de Lan√ßamento:</label>
                    <input id="editDataLancamento" name="editDataLancamento" type="date" class="form-control" [(ngModel)]="editDataLancamento">
                </div>

                <div class="form-group">
                    <label>Idiomas Dispon√≠veis:</label>
                    <div class="idiomas-container">
                        <label class="idioma-item" *ngFor="let idioma of idiomasDisponiveis">
                            <input type="checkbox" [checked]="idiomasSelecionados.includes(idioma)" (change)="toggleIdioma(idioma)">
                            {{ idioma }}
                        </label>
                    </div>
                </div>

                <div class="form-section requisitos-edicao">
                    <h5>Requisitos M√≠nimos</h5>
                    <div class="form-group">
                        <label for="reqSistema">Sistema Operacional:</label>
                        <input id="reqSistema" name="reqSistema" type="text" class="form-control" [(ngModel)]="jogoParaEditar.requisitosMinimos.sistema">
                    </div>
                    <div class="form-group">
                        <label for="reqProcessador">Processador:</label>
                        <input id="reqProcessador" name="reqProcessador" type="text" class="form-control" [(ngModel)]="jogoParaEditar.requisitosMinimos.processador">
                    </div>
                    <div class="form-group">
                        <label for="reqMemoria">Mem√≥ria RAM:</label>
                        <input id="reqMemoria" name="reqMemoria" type="text" class="form-control" [(ngModel)]="jogoParaEditar.requisitosMinimos.memoria">
                    </div>
                    <div class="form-group">
                        <label for="reqPlaca">Placa de V√≠deo:</label>
                        <input id="reqPlaca" name="reqPlaca" type="text" class="form-control" [(ngModel)]="jogoParaEditar.requisitosMinimos.placaVideo">
                    </div>
                    <div class="form-group">
                        <label for="reqArmazenamento">Armazenamento:</label>
                        <input id="reqArmazenamento" name="reqArmazenamento" type="text" class="form-control" [(ngModel)]="jogoParaEditar.requisitosMinimos.armazenamento">
                    </div>
                </div>

                <div class="form-group avaliacoes-leitura">
                    <label>Avalia√ß√µes:</label>
                    <div>
                        <span class="avaliacao-pos">üëç {{ jogoParaEditar.avaliacoesPositivas || 0 }}</span>
                        <span class="avaliacao-neg">üëé {{ jogoParaEditar.avaliacoesNegativas || 0 }}</span>
                    </div>
                </div>
            </div>

            <div class="botoes-edicao">
                <button type="submit" class="btn btn-salvar" [disabled]="!jogoParaEditar.nome || !jogoParaEditar.preco">
                    Salvar Altera√ß√µes
                </button>
                <button type="button" (click)="cancelarEdicao()" class="btn btn-cancelar">
                    Cancelar
                </button>
            </div>

        </form>
    </div>

    <div *ngIf="!isLoading && !estaEditando">
        
        <div *ngIf="listaJogos.length > 0" class="tabela-wrapper">
            <table class="tabela-jogos">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome do Jogo</th>
                        <th>Pre√ßo</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let jogo of listaJogos">
                        <td>{{ jogo.id }}</td>
                        <td>{{ jogo.nome }}</td>
                        <td>{{ jogo.preco | currency: 'BRL' }}</td>
                        <td class="acoes-coluna">
                            <button 
                                (click)="iniciarEdicao(jogo)" 
                                class="btn btn-editar" 
                                title="Editar Jogo">
                                Editar
                            </button>
                            
                            <button 
                                (click)="excluirJogo(jogo)" 
                                class="btn btn-excluir" 
                                title="Excluir Jogo">
                                Excluir
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div *ngIf="listaJogos.length === 0" class="alerta informacao">
            Nenhum jogo encontrado na base de dados.
        </div>
    </div>
</section>